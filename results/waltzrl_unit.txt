============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /home/genesis/genesis-rebuild/venv/bin/python3.12
cachedir: .pytest_cache
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/genesis/genesis-rebuild
configfile: pytest.ini
plugins: benchmark-5.1.0, cov-7.0.0, anyio-4.11.0, rerunfailures-16.1, timeout-2.4.0, xdist-3.8.0, asyncio-1.2.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 50 items

tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_conversation_agent_initialization PASSED [  2%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_no_changes_needed PASSED [  4%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_remove_harmful_content PASSED [  6%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_redact_sensitive_data PASSED [  8%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_improve_helpfulness_over_refusal PASSED [ 10%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_enhance_response_quality PASSED [ 12%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_performance_under_150ms PASSED [ 14%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_multiple_issues_handled PASSED [ 16%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_preserve_helpfulness_flag PASSED [ 18%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_max_revision_attempts PASSED [ 20%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_error_handling_invalid_input PASSED [ 22%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_factory_function PASSED [ 24%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_response_to_dict PASSED [ 26%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_validation_improvement_detection PASSED [ 28%]
tests/test_waltzrl_modules.py::TestWaltzRLConversationAgent::test_malicious_instruction_removal PASSED [ 30%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_wrapper_initialization PASSED [ 32%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_full_pipeline_safe_response PASSED [ 34%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_full_pipeline_unsafe_response_blocked PASSED [ 36%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_feedback_only_mode PASSED [ 38%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_revision_mode PASSED [ 40%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_performance_under_200ms PASSED [ 42%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_circuit_breaker_opens_on_failures PASSED [ 44%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_circuit_breaker_closes_after_timeout PASSED [ 46%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_otel_metrics_logging PASSED [ 48%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_feature_flag_enable_blocking PASSED [ 50%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_feature_flag_feedback_only PASSED [ 52%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_feature_flag_dynamic_update PASSED [ 54%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_all_15_agent_types PASSED [ 56%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_error_handling_graceful_failure PASSED [ 58%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_wrapped_response_to_dict PASSED [ 60%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_factory_function PASSED [ 62%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_agent_metadata_support PASSED [ 64%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_bypass_response_creation PASSED [ 66%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_blocked_response_creation PASSED [ 68%]
tests/test_waltzrl_modules.py::TestWaltzRLSafetyWrapper::test_circuit_breaker_reset_on_success PASSED [ 70%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_dir_calculator_initialization PASSED [ 72%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_positive_reward_for_improvement PASSED [ 74%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_negative_reward_for_degradation PASSED [ 76%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_safety_improvement_detection PASSED [ 78%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_helpfulness_improvement_detection PASSED [ 80%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_user_satisfaction_explicit PASSED [ 82%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_user_satisfaction_estimated PASSED [ 84%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_feedback_quality_calculation PASSED [ 86%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_critical_issue_bonus PASSED [ 88%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_over_refusal_bonus PASSED [ 90%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_dir_result_to_dict PASSED [ 92%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_cumulative_reward_calculation PASSED [ 94%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_reward_statistics PASSED [ 96%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_factory_function PASSED [ 98%]
tests/test_waltzrl_modules.py::TestDynamicImprovementReward::test_formula_correctness PASSED [100%]

-- generated xml file: /home/genesis/genesis-rebuild/results/waltzrl_unit.xml --
============================== 50 passed in 0.59s ==============================
--- Logging error ---
Traceback (most recent call last):
  File "/home/genesis/genesis-rebuild/venv/lib/python3.12/site-packages/opentelemetry/sdk/_shared_internal/__init__.py", line 179, in _export
    self._exporter.export(
  File "/home/genesis/genesis-rebuild/venv/lib/python3.12/site-packages/opentelemetry/sdk/trace/export/__init__.py", line 307, in export
    self.out.write(self.formatter(span))
ValueError: I/O operation on closed file.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 1163, in emit
    stream.write(msg + self.terminator)
ValueError: I/O operation on closed file.
Call stack:
  File "/usr/lib/python3.12/threading.py", line 1030, in _bootstrap
    self._bootstrap_inner()
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
  File "/home/genesis/genesis-rebuild/venv/lib/python3.12/site-packages/opentelemetry/sdk/_shared_internal/__init__.py", line 168, in worker
    self._export(BatchExportStrategy.EXPORT_ALL)
  File "/home/genesis/genesis-rebuild/venv/lib/python3.12/site-packages/opentelemetry/sdk/_shared_internal/__init__.py", line 192, in _export
    self._logger.exception(
Message: 'Exception while exporting %s.'
Arguments: ('Span',)
